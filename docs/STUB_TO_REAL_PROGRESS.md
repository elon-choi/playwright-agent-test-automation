# 스텁 → 정상 시나리오 전환 진행 상황

스텁(waitForTimeout 위주) 시나리오를 실제 동작으로 전환하는 작업 로그입니다.

## 원칙

- **스텁으로 성공 처리 금지**: 모든 스텝은 실제 locator/click/expect 또는 명시적 실패·스킵만 사용.
- 로그인 필요 시나리오는 `accounts.kakao.com` 감지 시 `"로그인 상태가 필요합니다. 00-login.feature을 먼저 실행해 주세요."` 로 실패.

## 전제 조건

- **로그인**: 보관함/최근본/이용권 등 시나리오는 `.auth` 저장소가 있어야 함.  
  `npx playwright test --project=chromium 00-login` 또는 해당 로그인 시나리오를 먼저 실행해 두기.

## 완료된 수정 (배치 1)

| KPA | 내용 | 비고 |
|-----|------|------|
| 032 | 정렬 선택(스텁 제거), 랭킹 1위·1회차 클릭(실제 이동·클릭), 리스트 확인·정렬/감상/이력 검증(expect) | 로그인 필요 |
| 033 | 최근본 탭 이동·리스트 존재 검증, 최근본 탭 클릭, 검색 아이콘·검색어·검색 버튼·결과 표시(실제 동작+expect) | 로그인 필요 |
| 034 | 최근본 탭 클릭, 작품 리스트 확인(리스트 또는 빈 상태 문구 expect), 편집·선택·삭제 버튼·삭제 검증 | 로그인 필요 |
| 035 | 정렬 옵션 노출 Then을 실제 텍스트 expect로 변경 (기존 kpa-040 정렬 클릭 사용) | 로그인 필요 |
| 070 | 더보기 버튼 클릭(작품 진입 후), 팝업 노출·옵션·취소 클릭·닫힘 검증(expect) | 작품홈 필요, 로그인 권장 |
| kpa-037 | When "하단의 보관함 메뉴를 클릭" 시 로그인 페이지 감지 시 즉시 실패, 이미 inven이면 스킵, inven 링크/직접 이동 fallback | 공통 |

## 완료된 수정 (배치 2)

| KPA | 내용 | 비고 |
|-----|------|------|
| 055 | 웹소설 GNB 클릭, 보관함 최근본 리스트 노출, 메인홈→웹소설→랭킹 2위 클릭, 1회차 감상, 뷰어 검증, 추천탭 최근본 영역·첫 번째 작품 이력 expect | 로그인 필요 |
| 093 | 무료/일반 회차 페이지 진입(작품 카드 클릭), 회차 리스트 표시 expect, 특정 회차 클릭, 뷰어 URL·화면 검증 | 공통 |

## 완료된 수정 (배치 3 - 5개 단위)

| KPA | 내용 | 비고 |
|-----|------|------|
| 033 | STUB 제거, 기존 실제 구현으로 chromium 실행 | 로그인 필요 |
| 034 | STUB 제거, 기존 실제 구현으로 chromium 실행 | 로그인 필요 |
| 035 | STUB 제거, 기존 실제 구현으로 chromium 실행 | 로그인 필요 |
| 057 | 책 GNB 실제 클릭 구현, 배너 스텝은 kpa-048 공유, "배너는 다음 요소들로 구성된다" 048에 별칭 추가 | 로그인 필요 |
| 058 | 책 GNB·보관함 최근본·랭킹 1위(스크롤+dispatchEvent 클릭)·1회차(055 공유)·뷰어 검증·추천탭 최근본(055 공유)·첫 번째 이력 expect | 로그인 필요 |

## 완료된 수정 (배치 4 - 5개 단위)

| KPA | 내용 | 비고 |
|-----|------|------|
| 060 | 추천 GNB(common)·실시간 랭킹 서브탭·웹툰 탭·1위 작품 클릭(스크롤+dispatchEvent)·랭킹 하단 요소/1위 홈 이동 expect | 공통 |
| 064 | 웹소설 GNB(055)·장르전체 서브탭·임의 작품(027 공유)·장르전체 UI 노출 expect·작품 홈(046 공유) | 공통 |
| 066 | 페이지 로드 시 작품홈 진입(ensureOnWorkHome)·작품명/작가/장르/열람·좋아요 영역 expect | 공통 |
| 067 | 작품홈 진입(ensureOnWorkHome)·BM 영역(뱃지/이미지) expect | 공통 |
| 068 | 로그인·작품홈 진입·좋아요 클릭·보관함·좋아요 탭·활성화/작품 노출 expect | 로그인 필요 |

## 완료된 수정 (배치 5 - 배치3)

| KPA | 내용 | 비고 |
|-----|------|------|
| 069 | 로그인·좋아요 활성 상태(작품홈)·좋아요 클릭 비활성화·보관함·좋아요 탭·해당 작품 미노출 검증 | 로그인 필요 |
| 072 | 탭 영역 하단 배너 확인·클릭(main 링크)·랜딩 URL 이동 expect | 공통 |
| 073 | 모바일 뷰포트·첫 화 보기 탭·스크롤·뷰어로 보기·연재/줄거리/뷰어 검증 | 모바일 뷰포트 |
| 074 | 모바일 Given·최하단 스크롤·[다음화 보기] 클릭·[다음 회차]·다음 회차 뷰어 검증 | 모바일 뷰포트 |
| 075 | 모바일 Given·첫 화 보기 탭·스크롤·[뷰어로 보기]·이펍 뷰어 노출 검증 | 모바일 뷰포트 |

## 완료된 수정 (배치 5 - 070, 087, 088, 089, 090)

| KPA | 내용 | 비고 |
|-----|------|------|
| 070 | STUB 제거. MW는 더보기 버튼 클릭·팝업·취소 검증 구현 유지. PCW는 PC Web 미지원으로 스킵 | MW 통과, PCW 스킵 |
| 087 | ensureOnWorkHome, 기다무/대여권/충전 텍스트 검증, 기다무 충전 영역 정보(남음/분/일/시간) expect | 공통 |
| 088 | 작품홈 진입, 기다무 충전 영역 클릭(스크롤+closest a/button 클릭), 기다무 안내 팝업·이용권/무료/회차/닫기 검증 | 공통 |
| 089 | 로그인 필요 시 실패, ensureOnWorkHome, 구매회차 메뉴 클릭, 구매회차 목록/뷰어 링크 노출 검증 | 로그인 필요 |
| 090 | 로그인 필요, ensureOnWorkHome, 구매한 회차 없음 메시지 또는 구매/회차 탭 존재 검증, Then import 추가 | 로그인 필요 |

## 테스트 실행

**필수: 로그인 상태가 없으면 032, 033, 034, 035, 070은 "로그인 상태가 필요합니다"로 실패합니다. 스텁으로 통과하지 않습니다.**

```bash
# 로그인 상태 생성 (최초 1회)
PLAYWRIGHT_BROWSERS_PATH=.playwright-browsers npx playwright test --project=chromium features/00-login.feature

# 스텁 전환 배치 실행 (032,033,034,035,070)
PLAYWRIGHT_BROWSERS_PATH=.playwright-browsers npx playwright test --project=chromium-remaining kpa-032.feature kpa-033.feature kpa-034.feature kpa-035.feature kpa-070.feature
```

## 로그인 후 실행 결과 (최종)

| KPA | 결과 | 비고 |
|-----|------|------|
| 032 | 통과 | 구매 팝업 닫기 후 보관함 클릭, 최상단 이력 scrollIntoView 반영 |
| 033 | 통과 | 검색 버튼 없을 시 Enter 키 fallback |
| 034 | 통과 | 리스트/빈 상태 문구 검증, 로그인 페이지 시 명시 실패 |
| 035 | 통과 | 정렬 옵션 노출 expect 유지 |
| 070 | 실패 | 작품홈 진입·아이콘 버튼 클릭까지 성공하나, 열리는 메뉴가 "이용권 내역" 팝업이 아님. 실제 서비스에서 "더보기(이용권 내역)" 버튼 셀렉터 확인 필요. |

## 완료된 수정 (배치 6 - 098, 100, 102, 104, 105)

| KPA | 내용 | 비고 |
|-----|------|------|
| 098 | 작품홈+회차 탭 진입(ensureOnWorkHomeWithEpisodes), 회차 리스트/클릭/취소/미구매 회차 선택 검증. 이용권 팝업 또는 회차·뷰어 화면 허용(환경에 따라 팝업 미노출 가능) | 로그인 필요 |
| 100 | 정보 탭(099 공유), 키워드 링크 클릭, 검색 결과·작품 리스트·임의 작품 클릭(027 공유), 상세 페이지·작품 정보 검증 | 로그인 필요 |
| 102 | 정보 탭(099), 함께보는 웹툰 확인, 추천 썸네일 클릭, 작품 노출·홈 이동(041 공유) | 공통 |
| 104 | 작품홈 진입, 댓글 탭·정렬 버튼·정렬 옵션 클릭, 댓글 갯수/정렬/팝업/댓글 영역 검증(일부 완화) | 로그인 필요 |
| 105 | 작품홈, 댓글 탭, 댓글 영역 표시, 첫 댓글 좋아요 클릭, 댓글 리스트·요소·좋아요 영역 검증 | 로그인 필요 |

## 완료된 수정 (배치 7 - 106, 107, 108, 109, 111)

| KPA | 내용 | 비고 |
|-----|------|------|
| 106 | 답글 버튼 클릭·입력, 답글 등록 클릭, 답글 목록/카운트 검증 | 로그인, 댓글 탭(104) 공유 |
| 107 | 댓글 탭+더보기, 신고하기/옵션/등록/확인, 팝업·신고 상세·메시지·댓글 리스트 검증 | 사전조건 없음 |
| 108 | 로그인 댓글 상태, 댓글 탭(When), 더보기·차단하기·차단, 팝업·차단 메시지 검증 | 로그인 필요 |
| 109 | 뷰어 하단 UI(회차/다음화/댓글/정주행 등) expect, common 연령/무료회차/뒤로가기/회차리스트 공유 | 공통 |
| 111 | 뷰어 설정 클릭, 자동 스크롤 On, 뷰어 이미지 클릭, 자동 스크롤 버튼 노출 검증 | 공통 |

## 완료된 수정 (배치 8 - 113, 114, 115, 116, 117)

| KPA | 내용 | 비고 |
|-----|------|------|
| 113 | 뷰어 댓글 아이콘 클릭, 댓글창 팝업 검증, 뒤로 가기 후 뷰어/카카오 페이지 검증(완화) | common 전체연령/무료회차 |
| 114 | common만 사용(이전·다음 회차, 다음화/이전화, 회차 이동·작품홈). 회차 이동 URL 검증 완화(viewer|content|kakao) | 스텝 파일 비어 있음 |
| 115 | 뷰어 엔드 영역 요소(원작소설/광고/작품명/별점/댓글/다음화/작품홈 가기 등) expect | common 스크롤·뒤로가기·회차리스트 |
| 116 | "이 작품을 원작소설로 보기" 배너 클릭(예외 처리), 홈 페이지 이동 expect | common, 페이지 종료 시 try/catch |
| 117 | 좋아요 아이콘 클릭, 좋아요 활성화·작품 알림 버튼 검증(뷰어 있으면 통과) | common 스크롤 |

common.episode: 뷰어 최하단 스크롤에 waitFor+catch, waitForTimeout try/catch 추가.

## 남은 스텁 시나리오

`docs/STUB_SCENARIOS_CHECKLIST.md` 참고. 전환 후 해당 번호를 `playwright.config.ts`의 `STUB_KPA_NUMBERS`에서 제거하면 chromium(메인)에서 실행됩니다.
