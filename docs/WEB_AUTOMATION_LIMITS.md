# 웹 자동화 불가/가능 영역 정리

시나리오 판단 기준으로 **웹 자동화 가능 여부**를 정리한 문서입니다.

---

## 1. 시나리오 판단 정리 (자동화 가능 여부)

### 자동화 불가 (feature/step 삭제 완료)

| KPA | 사유 |
|-----|------|
| **138, 139** | 앱 전용 플로우 (앱으로 보기, 스토어 이동) |
| **083, 084** | 충전된 대여권/소장권을 **실제로 소진**해야 하는 케이스 |

위 4개 KPA는 feature 파일 및 steps 파일에서 삭제되었고, `playwright.config.ts`의 features/steps/STUB_KPA_NUMBERS에서도 제거됨.

### 자동화 가능

| KPA | 비고 |
|-----|------|
| **081, 082** | BDD 스텝을 변경하면 자동화 가능 |
| **097** | 단순 대여권 충전 화면 이동 확인 케이스라 가능 |

---

## 2. 자동화 불가 상세 (참고)

### 1) 앱 전용 플로우 (KPA-138, KPA-139)

- **시나리오**: "앱으로 보기" 버튼 클릭 → 스토어 이동 / 카카오페이지 앱 실행
- **이유**:  
  - "앱으로 보기" 클릭 시 **외부 앱(카카오페이지 앱) 실행** 또는 **앱스토어/플레이스토어 이동**이 목적이다.  
  - 웹 브라우저 자동화로는 **네이티브 앱 실행 여부**나 **스토어 앱 내부 화면**을 검증할 수 없다.  
  - 스토어 URL 이동까지는 자동화 가능하지만, "앱이 실행되며 해당 회차로 이동한다"는 **웹에서 검증 불가**.
- **권장**:  
  - 웹에서는 "앱으로 보기" 클릭 후 **웹에서 감상 불가 팝업/문구 노출**까지만 검증.  
  - "스토어로 이동한다"는 **URL이 스토어 도메인으로 바뀌는지**까지로 제한.  
  - 앱 실행·회차 진입 검증은 **앱 전용 테스트(Appium 등)** 로 분리.

### 2) 충전된 대여권/소장권 실제 소진 (KPA-083, 084)

- **시나리오**: 이미 충전된 대여권/소장권을 **실제로 사용(소진)**해야 검증이 완료되는 케이스.
- **이유**:  
  - 회차 감상 등으로 이용권을 **실제로 1회 소진**해야 하며, 테스트 반복 시 계정에 이용권이 소진되어 재현이 어렵다.  
  - 테스트용 대량 충전/리셋이 없으면 웹 E2E 자동화로 지속 실행하기 어렵다.
- **판단**: **자동화 불가** (위 시나리오 판단 정리와 동일).

### 3) PC에서 이용 불가 안내 (알림 등)

- **이미 반영**: KPA-016 등에서 `PC에서는 이용할 수 없습니다 | 카카오페이지 앱으로 확인해보세요` 노출 시 **해당 Then 스텝을 스킵**하는 방식으로 처리되어 있음.
- **의미**: 해당 기능은 **앱 전용**이므로, 웹에서는 "안내 문구가 뜨는지"만 검증 가능하고, 실제 기능 검증은 앱 테스트에서 수행하는 것이 맞음.

---

## 3. 자동화는 가능하지만 검증 범위를 나눠야 하는 영역

### 1) 이용권 내역·캐시 내역 **화면 노출** (KPA-018, 019, 071 등)

- **가능**: 메뉴 클릭 → "이용권 내역"/"캐시 내역" 화면 진입, 헤더·탭·리스트 영역 노출 여부.
- **한계**:  
  - "충전/사용 리스트가 **최근 순서대로** 노출된다"는 **데이터 정합성** 검증에 가깝이므로, 테스트 데이터가 고정이 아니면 플레이크가 생기기 쉽다.  
  - "N건만큼 있다" 같은 검증은 **테스트 계정·데이터 정책**이 있을 때만 안정적.
- **권장**:  
  - 웹 E2E에서는 "해당 화면으로 이동·필수 UI 노출" 위주로 두고,  
  - 순서/건수/금액 일치는 **API 테스트** 또는 **테스트 데이터가 고정인 경우**에만 추가.

### 2) 이용권 사용 확인 팝업 (KPA-026, 097, 098)

- **가능**: 설정 메뉴 클릭 → "이용권 사용 확인" 옵션 On/Off, 팝업 문구·버튼 노출.  
  (실제 이용권 소진/구매는 위 결제 영역과 동일하게 제한.)
- **권장**:  
  - 팝업 **노출·문구·버튼 동작**만 웹에서 검증하고,  
  - "이용권 N장 사용" 등 실제 차감은 백엔드/시뮬레이션으로 검증.

### 3) 푸시 알림 안내 문구 (KPA-088 등)

- **시나리오**: "이용권이 지급되면 푸시 알림으로 안내드립니다" 같은 **문구가 화면에 있는지**.
- **가능**: 해당 텍스트가 DOM에 노출되는지까지는 웹 자동화로 검증 가능.
- **불가**: 실제 푸시가 디바이스에 오는지는 **앱/백엔드** 검증 영역.

---

## 4. 요약 표 (참고)

| 구분 | 대표 KPA | 웹에서 가능한 범위 | 웹에서 불가/한계 |
|------|----------|-------------------|------------------|
| 앱 전용 (불가) | 138, 139 | 팝업 노출, (선택) 스토어 URL 이동 | 앱 실행·회차 이동 검증 |
| 이용권 실제 소진 (불가) | 083, 084 | - | 충전된 대여권/소장권 실제 소진 필요 |
| BDD 스텝 변경 시 가능 | 081, 082 | 스텝 변경 후 자동화 가능 | - |
| 충전 화면 이동 (가능) | 097 | 단순 대여권 충전 화면 이동 확인 | - |
| 이용권/캐시 내역 | 018, 019, 071 | 화면 진입·필수 UI 노출 | 리스트 순서/건수(데이터 의존) |
| PC 이용 불가 안내 | 016 (알림 등) | "PC에서는 이용할 수 없습니다" 문구 노출 | 해당 기능 실제 동작(앱에서 검증) |

---

## 5. 정리

- **자동화 불가 (시나리오 판단 기준)**: **138, 139** (앱 전용), **083, 084** (이용권 실제 소진).
- **자동화 가능**: **081, 082** (BDD 스텝 변경 시), **097** (충전 화면 이동 확인).
- 테스트 설계 시 위 **섹션 1** 표를 기준으로 웹 E2E 범위를 나누고, 불가 시나리오는 스킵 또는 별도 채널(앱/API)로 검증하는 것을 권장한다.
